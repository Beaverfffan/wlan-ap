From 6788013ef457bd747fd6a9590320fac826a73d9b Mon Sep 17 00:00:00 2001
From: John Crispin <john@phrozen.org>
Date: Wed, 8 Jan 2025 10:43:14 +0100
Subject: [PATCH 84/84] base-files: add generate_interface_none()

Signed-off-by: John Crispin <john@phrozen.org>
---
 package/base-files/files/bin/config_generate | 21 +++++++++++++++++++-
 1 file changed, 20 insertions(+), 1 deletion(-)

diff --git a/package/base-files/files/bin/config_generate b/package/base-files/files/bin/config_generate
index 23e96b8f5b..0ac9f3f646 100755
--- a/package/base-files/files/bin/config_generate
+++ b/package/base-files/files/bin/config_generate
@@ -307,6 +307,24 @@ generate_switch() {
 	json_select ..
 }
 
+generate_interface_none() {
+	local device none
+
+	json_select network
+		json_select "$1"
+			json_get_vars device none
+		json_select ..
+	json_select ..
+
+	[ "$none" -eq 1 ] && {
+		uci -q batch <<-EOF
+			set network.${device}_none=interface
+			set network.${device}_none.proto=none
+			set network.${device}_none.device=$device
+		EOF
+	}
+}
+
 generate_static_system() {
 	uci -q batch <<-EOF
 		delete system.@system[0]
@@ -520,7 +538,8 @@ if [ ! -s /etc/config/network ]; then
 	}
 
 	json_get_keys keys network
-	#for key in $keys; do generate_network $key $bridge_name; done
+	for key in $keys; do generate_network $key $bridge_name; done
+	for key in $keys; do generate_interface_none $key; done
 
 	json_get_keys keys switch
 	for key in $keys; do generate_switch $key; done
-- 
2.34.1

